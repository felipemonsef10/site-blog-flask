{% extends 'base.html' %}


{% block body %}
<div class="container">
    <div class="card border shadow-sm w-100 mt-5">
        <div class="row g-0 d-flex">

            <div class="col-md-4 d-flex align-items-center justify-content-center bg-light post-image-column">

                <img src="{{ url_for('static', filename='fotos_perfil/{}'.format(post.autor.foto_perfil)) }}"
                    class="img-fluid post-img-standard-contain" alt="Imagem de {{ post.titulo }}">
            </div>

            <div class="col-md-8">
                <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-4">
                                <h5>
                                    {{ post.titulo }}
                                </h5>
                            </div>
                            <div class="col-md-7 gap-2 d-md-flex justify-content-md-end">
                                {% if form %}
                                    <button class="btn btn-primary btn-sm" href="#form_editar_post">Editar Post</button>
                                    <button class="btn btn-danger btn-sm" href="#" data-bs-toggle="modal" data-bs-target="#ExcluirPost">Excluir Post</button>
                                {% endif %}
                            </div>
                        </div>

                    <p class="card-text text-secondary text-break">{{ post.corpo }}</p>
                    <p class="card-text mt-3">
                        <small class="text-muted">Por: {{ post.autor.username }}</small><br>
                        <small class="text-muted">Email: {{ post.autor.email }}</small><br>
                        <small class="text-muted">Criado em: {{ post.data_criacao.strftime('%d/%m/%Y') }}</small>
                    </p>

                </div>
            </div>
        </div>
    </div>


    <!-- Editar Post -->

    {% if form %}
        <div class="card border shadow-sm w-100 mt-5">
            <form action="" id="form_editar_post" method="POST">
                {{ form.csrf_token }}

                <div class="row g-0 d-flex">
                    <div class="col-md-8">
                        <div class="card-body p-4">
                            <h5>{{ form.titulo.label }}</h5>
                            {% if form.titulo.errors %}
                                {{ form.titulo(class="form-control is-invalid") }}
                                <div class="invalid-feedback">
                                    {% for erro in form.titulo.errors %}
                                        {{ erro }}
                                    {% endfor %}
                                </div>

                            {% else %}
                                {{ form.titulo(class="form-control") }}
                            {% endif %}
                            
                            <h5>{{ form.corpo.label }}</h5>
                            {% if form.corpo.errors %}
                                {{ form.corpo(class="form-control is-invalid") }}
                                <div class="invalid-feedback">
                                    {% for erro in form.corpo.errors %}
                                        {{ erro }}
                                    {% endfor %}
                                </div>

                            {% else %}
                                {{ form.corpo(class="form-control") }}
                            {% endif %}

                            <!-- {{ form.botao_submit_criar_post(class="btn btn-primary mb-3 mt-3") }} -->
                            <button type="submit" class="btn btn-primary mb-3 mt-3">Confirmar</button>
                        </div>
                    </div>
                </div>

            </form>
        </div>
    {% endif %}

</div>



<style>
    /* Define a altura fixa para a coluna da imagem, garantindo que o texto e a imagem fiquem alinhados */
    .post-image-column {
        /* Defina uma altura ideal. Ajustei para 250px, pois é um bom equilíbrio. 
             O 'card-body' na coluna do texto ditará a altura final do cartão.
             */
        height: 250px;
        overflow: hidden;
        /* Garante que nada passe desta altura */
    }

    .post-img-standard-contain {
        /* Essencial para o modo 'contain' */
        height: 100%;
        /* Ocupa 100% da altura da coluna ('post-image-column') */
        width: 100%;
        /* Ocupa 100% da largura da coluna ('col-md-4') */

        /* ESSENCIAL: Garante que a imagem inteira seja visível. */
        object-fit: contain;
    }
</style>

<!-- Modal -->
<div class="modal fade" id="ExcluirPost" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Excluir Post</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Deseja realmente Excluir o Post?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                <form action="{{ url_for('excluir_post', post_id=post.id) }}" method="POST">
                    <button type="submit" class="btn btn-danger">Excluir</button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}